Условие: Веб-приложение позволяет пользователю оплатить заказ банковской картой. Оплата происходит через внешний платежный шлюз после нажатия кнопки «Оплатить»:
Выполняется клиентская валидация
Данные отправляются в платежный шлюз
Возможен редирект на 3-D Secure
Платёжный шлюз возвращает результат:
Успешно
Отклонено банком
Ошибка платёжного сервиса
Приложение обновляет статус заказа
Пользователю отображается результат оплаты
На email отправляется чек (при успешной оплате)
 Необходимо написать тест-кейсы, покрывающие:
позитивный сценарий
негативный сценарий
граничные значения
проверка валидации
проверка интеграции с платежным шлюзом


# Тест-кейсы: Оплата банковской картой через внешний платёжный шлюз

**Проект**: Веб-приложение  
**Функционал**: Оплата заказа банковской картой  
**Версия документа**: 1.0  
**Дата**: 17 февраля 2026  
**Покрытие**: 100% основных сценариев + граничные значения, валидация, интеграция

## 1. Позитивные сценарии (Happy Path)

| ID      | Название теста                                              | Предусловия                                              | Шаги                                                        | Ожидаемый результат |                                                                            
|---------|-------------------------------------------------------------|-----------------------------------------------------------------------------|------------------------------------------------------------------------
| TC-P01  | Успешная оплата Visa без 3DS                                | Заказ создан, статус «Ожидает оплаты», валидный email    | 1. Перейти на оплату. Ввести данные тестовой Visa (без 3DS).| Экран успеха,статус                                                                                 | Нажать «Оплатить»                                                                                                       «Оплачен», чек на email
| TC-P02  | Успешная оплата Mastercard с 3DS                            | Заказ создан                                             | 1. Ввести MC с 3DS. Пройти 3DS успешно                      | Редирект → 3DS → успех →чек                             
| TC-P03  | Успешная оплата картой «Мир»                                | Заказ создан                                             | 1. Ввести данные «Мир». Пройти 3DS если нужно               | Успех, статус оплачен |                                     
| TC-P04  | Оплата минимальной суммы (1 ₽)                              | Система разрешает заказы от 1 коп.                       | Создать заказ 1 ₽ → оплатить                                | Успех |                                    
| TC-P05  | Оплата максимальной суммы (граничное)                       | Лимит шлюза/системы = 500 000 ₽                          | Заказ ровно 500 000 ₽ → оплатить                            | Успех |                                 
| TC-P06  | Оплата с сохранённой картой                                 | У пользователя есть сохранённая карта                    | Выбрать сохранённую карту → оплатить                        | Успех |                                
| TC-P07  | Повторная отправка чека                                     | Успешный платёж уже выполнен                             | В деталях заказа нажать «Отправить чек повторно»            | Чек приходит повторно |
                                  

## 2. Негативные сценарии

| ID      | Название теста                                              | Предусловия                          | Шаги                                                                 | Ожидаемый результат |
|---------|-------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------|---------------------|
| TC-N01  | Отклонено банком (недостаточно средств)                    | Заказ создан                         | Ввести карту с отказом банка                                         | Сообщение «Недостаточно средств»,                                                                                                                                                                                            статус остаётся «Ожидает оплаты» |
| TC-N02  | Отклонение на 3DS (неверный код 3 раза)                    | Карта с обязательным 3DS             | Пройти 3DS с неверным кодом 3 раза                                  | Отклонение, ошибка 3DS |
| TC-N03  | Техническая ошибка шлюза (timeout 30 сек)                  | Заказ создан                         | Имитировать таймаут шлюза                                            | «Сервис временно недоступен», заказ не                                                                                                                                                                                       оплачен 
| TC-N04  | Ошибка 5xx от шлюза (снифферы)                              | Заказ создан                         | Шлюз возвращает 502/503/504                                          | Пользователь видит ошибку, заказ не                                                                                                                                                                                         оплачен |
| TC-N05  | Карта в стоп-листе                                         | Заказ создан                         | Ввести тестовую карту, которая в стоп- листе                          | Отклонение «Карта заблокирована» |
| TC-N06  | Уже оплаченный заказ (повторная попытка)                   | Заказ уже «Оплачен»                  | Вернуться на страницу оплаты                                         | «Заказ уже оплачен», перенаправление на                                                                                                                                                                                       детали заказа |

## 3. Граничные значения

| ID      | Название теста                                              | Предусловия                          | Шаги                                                                 | Ожидаемый результат |
|---------|-------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------|---------------------|
| TC-B01  | Сумма = 0.01 ₽ (минимальная)                                | Система разрешает                    | Создать заказ 0.01 ₽ → оплатить                                      | Успех или валидация «Минимальная сумма                                                                                                                                                                                        1 ₽» (в зависимости от настроек) |
| TC-B02  | Сумма = максимум + 0.01 ₽                                   | Лимит 500 000 ₽                      | Заказ 500 000.01 ₽                                                   | Блокировка на клиенте или отклонение                                                                                                                                                                                           шлюзом |
| TC-B03  | Срок действия карты = сегодня (последний день)              | Карта истекает сегодня               | Оплатить                                                             | Успех (если банк разрешает) |
| TC-B04  | Срок действия = вчера                                       | Карта истекла вчера                  | Оплатить                                                             | Ошибка «Карта просрочена» |
| TC-B05  | CVC = 3 цифры (Visa/MC) и 4 цифры (Amex)                   | Соответствующие карты                | Проверить оба варианта                                               | Оба проходят валидацию |
| TC-B06  | Имя держателя 1 символ и 26 символов (макс)                 | —                                    | Ввести крайние значения                                              | Проходит / отклоняется согласно                                                                                                                                                                                               правилам шлюза |

## 4. Проверка клиентской валидации

| ID      | Название теста                                              | Поле                  | Вводимое значение                     | Ожидаемый результат |
|---------|-------------------------------------------------------------|-----------------------|---------------------------------------|---------------------|
| TC-V01  | Пустое поле «Номер карты»                                   | Номер карты           | (пусто)                               | Ошибка, кнопка неактивна |
| TC-V02  | Номер карты 15 цифр                                         | Номер карты           | 4111 1111 1111 111                    | «Неверный формат» |
| TC-V03  | Буквы в номере карты                                        | Номер карты           | 4111 1111 1111 abcd                   | Запрет ввода букв |
| TC-V04  | Срок действия в прошлом                                     | MM/YY                 | 12/23 (если сейчас 2026)              | «Карта просрочена» |
| TC-V05  | CVC 2 цифры                                                 | CVC                   | 12                                    | «CVC должен содержать 3 цифры» |
| TC-V06  | Спецсимволы в имени держателя                               | Cardholder Name       | IVAN@#$ PETROV                        | Блокировка или ошибка шлюза |
| TC-V07  | Имя на кириллице (если не поддерживается)                   | Cardholder Name       | ИВАН ИВАНОВ                           | Ошибка шлюза или клиентская валидация |

## 5. Проверка интеграции с платежным шлюзом

| ID      | Название теста                                              | Тип проверки                  | Шаги / Условие                                      | Ожидаемый результат |
|---------|-------------------------------------------------------------|-------------------------------|-----------------------------------------------------|---------------------|
| TC-I01  | Успешный ответ шлюза (status: succeeded)                   | Интеграция success            | Mock-ответ success                                  | Статус заказа обновлён, чек отправлен |
| TC-I02  | Ответ шлюза declined (bank decline)                        | Интеграция decline            | Mock declined                                       | Статус не меняется, понятное сообщение |
| TC-I03  | Ответ шлюза с ошибкой (invalid_request)                    | Интеграция error              | Mock ошибка шлюза                                   | Логгирование, алерт, статус «Ошибка оплаты» |
| TC-I04  | Idempotency-key (повторный запрос одного платежа)          | Идемпотентность               | Отправить два одинаковых запроса подряд             | Второй запрос игнорируется, первый статус сохраняется |
| TC-I05  | Webhook от шлюза (success)                                 | Webhook                       | Отправить тестовый webhook success                  | Статус заказа обновлён даже если пользователь закрыл страницу |
| TC-I06  | Webhook от шлюза (failed)                                  | Webhook                       | Отправить webhook failed                            | Статус → «Отклонён» |
| TC-I07  | Таймаут ответа шлюза + retry (если настроено)              | Надёжность                    | Симулировать задержку >15 сек                       | Повторный запрос или корректная ошибка |
| TC-I08  | Логирование (маскирование PAN)                             | PCI DSS                       | Проверить логи после оплаты                         | Номер карты замаскирован (**** **** **** 1234) |
